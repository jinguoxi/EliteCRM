<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print" />

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <title>EliteCRM by loriling</title>
  </head>

  <body>
    <header>
      <div class="inner">
        <h1>EliteCRM</h1>
        <h2>FlexClient</h2>
        <a href="https://github.com/loriling/EliteCRM" class="button"><small>View project on</small>GitHub</a>
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">
		<h2>Flex客户端常见卡死情况与排除</h2>
          <p>1.打开fiddler，查看网络请求中是否有哪个请求是长时间没有响应的。
    由于客户端请求绝大多数是同步请求，因此发出请求没有响应，则客户端现象就是浏览器僵死。</p>

<p>2.可以先尝试使用非软电话登录，如果在非软电话清空下，不会卡死，则多数卡死原因出在软电话中。
    因为软电话与后台服务连接也都是同步的请求，如果与后台aps或者cti之间网络存在些许异常，就可能出现客户端浏览器卡死现象。
    软电话与APS连接查看EliteServerProxy.log，软电话与CTI连接查看ComCTIClient.log和CTIClient.log，有的地方还需要查看对应的CTIExtra日志</p>

<p>3.更换浏览器尝试。
    也许刚好你用的ie本身就有问题，所以可以试试360浏览器，遨游浏览器等等是不是可以正常，如果可以，则可能需要重装ie或者升级ie版本。</p>

<p>4.使用debug版本flashplayer（使用debug的目的是让客户端日志可以输出错误堆栈，有助于快速定位问题）
    EliteClient.log中也许会出现：
        #1502: 脚本的执行时间已经超过了 15 秒的默认超时设置。
    类似这样的错误日志。这句日志就可以看出客户端flex调用某个方法执行时间超过了flex内置的超时时长（日志中看到15秒，其实应该是1分钟）。
    也就是说，这句报错说明了当前这句命令，造成了客户端卡死。如果可以看到日志中有类似：begin call xxxxx 。。那也就可以判定就是这个xxxx造成了调用超时，具体原因就可以进一步分析。</p>

<p>5.去现场之前记得先下载好最新的debug版本flashplayer，以便出了问题后安装上去，方便看日志。
    下载地址：<a href="http://www.adobe.com/support/flashplayer/downloads.html">http://www.adobe.com/support/flashplayer/downloads.html</a>
    记得是下载activex for ie的。。。。</p>

<p>6.客户端清空浏览器缓存，这个有的ie下，清空时候有个勾选是否保留收藏夹中内容的，很多人勾上了这个然后又刚好把登录地址放在收藏夹内，这样是删不掉缓存的，要去掉这个勾选。
    其实，只需要勾选上"Internet 临时文件"即可，其他都不用勾。
    如果确认了删了缓存了，还是出现版本不对问题，可以尝试查看ie是否设置了代理，也许是代理那边有缓存。</p>
	
	<h2>web应用与它们的日志</h2>
	<p>1.首先去看log4j.properties文件的配置，看是不是有日志输出，是不是没加上,R</p>
	<p>2.如果一个应用根本就没能成功起来，那就可以先配置成输出所有日志：log4j.rootLogger=debug,stdout,R ，这样可以看到第三方jar中输出的所有日志，方便问题排查。</p>
	<p>3.tomcat有个manager界面，可以管理webapps下的应用，这里可以看到应用是否正常启动。可以通过tomcat主页进入manager界面，用户名密码再tomcat-user.xml中配置</p>
		
	<h2>FlexScript Bible</h2>
	<p>1.关于软电话操作的那些FlexScript：<br>
		(1)拨打电话:<br>
			import Elite.EXSoftPhone.EXSoftPhone;<br>
			EXSoftPhone.makeCall("8003","xxxx=123|oooo=456");<br>
		(2)挂断电话:<br>
			import Elite.EXSoftPhone.EXSoftPhone;<br>
			EXSoftPhone.releaseCall();<br>
		(3)接起电话:<br>
			import Elite.EXSoftPhone.EXSoftPhone;<br>
			EXSoftPhone.answerCall();<br>
		(4)发起会议:<br>
			import Elite.EXSoftPhone.EXSoftPhone;<br>
			EXSoftPhone.initConference("8003","xxxx=123|oooo=456");<br>
			
		(5)完成会议:<br>
			import Elite.EXSoftPhone.EXSoftPhone;<br>
			EXSoftPhone.compConference();<br>
		(6)发起转接:<br>
			import Elite.EXSoftPhone.EXSoftPhone;<br>
			EXSoftPhone.initTransfer("8003","xxxx=123|oooo=456");<br>
		(7)完成转接:<br>
			import Elite.EXSoftPhone.EXSoftPhone;<br>
			EXSoftPhone.compTransfer();<br>
		(8)单步转:<br>
			import Elite.EXSoftPhone.EXSoftPhone;<br>
			EXSoftPhone.muteTransfer("8003","xxxx=123|oooo=456");<br>
		(9)接回:<br>
			import Elite.EXSoftPhone.EXSoftPhone;<br>
			EXSoftPhone.reconnect();<br>
		(10)通知进入工作:<br>
			import Elite.EXSoftPhone.EXSoftPhone;<br>
			EXSoftPhone.notifyWorkStart("WT-OB");//WT-OB代表外拨 WT-IB代表呼入<br>
		(11)通知结束工作:<br>
			import Elite.EXSoftPhone.EXSoftPhone;<br>
			EXSoftPhone.notifyWorkEnd();<br>
		(12)软电话的CommonCall:<br>
			import Elite.EXSoftPhone.EXSoftPhone;<br>
			EXSoftPhone.commonCall("callName","callParam");<br>
		(13)获取随路数据:<br>
			import Elite.EXSoftPhone.EXSoftPhone;<br>
			EXSoftPhone.attachData("key");<br>
			
		(14)发送消息给IVR:<br>
			import Elite.EXSoftPhone.EXSoftPhone;<br>
			EXSoftPhone.sendIVRMessage("message");<br>
		(15)软电话退出:<br>
			import Elite.EXSoftPhone.EXSoftPhone;<br>
			EXSoftPhone.quitSoftphone();<br>
		(16)软电话准备好:<br>
			import Elite.EXSoftPhone.EXSoftPhone;<br>
			EXSoftPhone.agentReady();<br>
		(17)软电话未准备好:<br>
			import Elite.EXSoftPhone.EXSoftPhone;<br>
			EXSoftPhone.agentNotReady(3);//3是默认的AUX状态<br>
		(18)强制话务员登出:<br>
			import Elite.EXSoftPhone.EXSoftPhone;<br>
			EXSoftPhone.forceAgentLogout("dn","agent_id");<br>
			
		(19)强制话务员未准备好:<br>
			import Elite.EXSoftPhone.EXSoftPhone;<br>
			EXSoftPhone.forceAgentNotReady("dn","agent_id");<br>
		(20)强制话务员准备好:<br>
			import Elite.EXSoftPhone.EXSoftPhone;<br>
			EXSoftPhone.forceAgentReady("dn","agent_id");<br>
		(21)监听:<br>
			import Elite.EXSoftPhone.EXSoftPhone;<br>
			EXSoftPhone.listen("dn");<br>
		(22)拦截:<br>
			import Elite.EXSoftPhone.EXSoftPhone;<br>
			EXSoftPhone.intercept("agent_id");<br>
		(23)根据dn号强制断开agent连接:<br>
			import Elite.EXSoftPhone.EXSoftPhone;<br>
			EXSoftPhone.forceDisconnectAgentByDN("dn");<br>
		(24)强制挂断:<br>
			import Elite.EXSoftPhone.EXSoftPhone;<br>
			EXSoftPhone.forceHangUp();<br>
			
		(25)强插:<br>
			import Elite.EXSoftPhone.EXSoftPhone;<br>
			EXSoftPhone.bargeIn("dn");<br>
		(26)接管:<br>
			import Elite.EXSoftPhone.EXSoftPhone;<br>
			EXSoftPhone.takeOver("dn","agent_id");<br>
		(27)暗语:<br>
			import Elite.EXSoftPhone.EXSoftPhone;<br>
			EXSoftPhone.coach("dn","agent_id");<br>
		(28)静音:<br>
			import Elite.EXSoftPhone.EXSoftPhone;<br>
			EXSoftPhone.mute();<br>
		(29)取消静音:<br>
			import Elite.EXSoftPhone.EXSoftPhone;<br>
			EXSoftPhone.unmute();<br>
			
		(30)发送DTMF:<br>
			import Elite.EXSoftPhone.EXSoftPhone;<br>
			EXSoftPhone.sendDTMF("1");<br>
		(31)软电话登录:<br>
			import Elite.EXSoftPhone.EXSoftPhone;<br>
			EXSoftPhone.login();<br>
		(32)软电话登出:<br>
			import Elite.EXSoftPhone.EXSoftPhone;<br>
			EXSoftPhone.logout();<br>
		(33)开始播放:<br>
			import Elite.EXSoftPhone.EXSoftPhone;<br>
			EXSoftPhone.startPlay("f:/temp/xxx.wav");<br>
		(34)结束播放:<br>
			import Elite.EXSoftPhone.EXSoftPhone;<br>
			EXSoftPhone.stopPlay();<br>
	</p>
	<p>2.FlexScript添加js代码并调用：<br>
		<textarea readonly cols="100" rows="12">
import flash.external.ExternalInterface;
	var insertScript:String = "document.insertScript = function() {"+
		"if (document._test==null){" + 
		"_test = function(){" +
			"alert('test');"+//具体_test方法做的事情
		"}"+
	"}"+
"}";
ExternalInterface.call(insertScript);//将上述定义的js脚本插入到dom中
ExternalInterface.call("_test");//调用插入的js方法
		</textarea>
		<br>
		
	</p>
        </section>
		
        <aside id="sidebar">
          
          <p class="repo-owner"><a href="https://github.com/loriling/EliteCRM"></a> is maintained by <a href="https://github.com/loriling">loriling</a>.</p>

          <p>This page was generated by <a href="pages.github.com">GitHub Pages</a> using the Architect theme by <a href="http://twitter.com/jasonlong">Jason Long</a>.</p>
        </aside>
      </div>
    </div>

  
  </body>
</html>