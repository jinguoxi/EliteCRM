<!DOCTYPE html><html><head><title>WebChat 帮助文档</title><meta charset='utf-8'><link href='https://dn-maxiang.qbox.me/res-min/themes/marxico.css' rel='stylesheet'><style></style></head><body><div id='preview-contents' class='note-content' style='max-width:1000px;margin:auto'>
                        
                    



<h1 id="webchat-帮助文档">WebChat 帮助文档</h1>

<div><div class="toc"><div class="toc">
<ul>
<li><a href="#webchat-帮助文档">WebChat 帮助文档</a><ul>
<li><a href="#一-webchat中涉及到的系统参数">一. WebChat中涉及到的系统参数</a><ul>
<li><a href="#1-webchat中独有的系统参数">1. WebChat中独有的系统参数</a><ul>
<li><a href="#chaton-ngs-chat插件中是否显示客户的来源类型">CHATON ngs chat插件中是否显示客户的来源类型</a></li>
<li><a href="#chaecs-ngs-chat插件是否与软电话互斥">CHAECS ngs chat插件是否与软电话互斥</a></li>
<li><a href="#chasem-是否使用emoji表情">CHASEM 是否使用EMOJI表情</a></li>
<li><a href="#chtsty-ngs-chat插件界面样式">CHTSTY ngs chat插件界面样式</a></li>
<li><a href="#chassb-ngs-chat插件是否在聊天界面上直接显示转接相关按钮">CHASSB  ngs chat插件是否在聊天界面上直接显示转接相关按钮</a></li>
<li><a href="#swaprl-ngs-chat插件左右布局位置">SWAPRL ngs chat插件左右布局位置</a></li>
<li><a href="#chatad-ngs-chat插件访问webchat服务的地址">CHATAD ngs chat插件访问webchat服务的地址</a></li>
<li><a href="#efsadd-ngs-chat插件中配置的ewcfront地址">EFSADD ngs chat插件中配置的EWCFront地址</a></li>
<li><a href="#ctacsd-ngs-chat插件关闭会话时候是否发出事件">CTACSD ngs chat插件关闭会话时候是否发出事件</a></li>
<li><a href="#chttag-ngs-chat插件中-客户标签表名">CHTTAG ngs chat插件中 客户标签表名</a></li>
<li><a href="#cacren-ngs-chat插件中是否开启客户评级">CACREN ngs chat插件中是否开启客户评级</a></li>
<li><a href="#sronot-切换到机器人聊天时候的提示语">SRONOT 切换到机器人聊天时候的提示语</a></li>
<li><a href="#chatsm-结束会话时候是否要小结或者发出相关命令组通知客户端">CHATSM 结束会话时候是否要小结或者发出相关命令组通知客户端</a></li>
<li><a href="#srrtst-坐席是否显示满意度结果">SRRTST 坐席是否显示满意度结果</a></li>
<li><a href="#cmaxbu-客服允许的最大置忙数">CMAXBU 客服允许的最大置忙数</a></li>
<li><a href="#ipbpar-黑名单规则">IPBPAR 黑名单规则</a></li>
<li><a href="#chslsc-显示历史会话内容数">CHSLSC 显示历史会话内容数</a></li>
<li><a href="#chahat-坐席端顶部显隐控制">CHAHAT 坐席端顶部显隐控制</a></li>
<li><a href="#chatlt-坐席端显示布局类型">CHATLT 坐席端显示布局类型</a></li>
</ul>
</li>
<li><a href="#2-那些公共使用的系统参数">2. 那些公共使用的系统参数</a><ul>
<li><a href="#logdes-des加密时候的秘钥">LOGDES DES加密时候的秘钥</a></li>
<li><a href="#lognam-登录使用staff的agentid还是loginname">LOGNAM 登录使用staff的agent_id还是loginname</a></li>
<li><a href="#kmrurl-知识库服务地址">KMRURL 知识库服务地址</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
</div>



<h2 id="一-webchat中涉及到的系统参数">一. WebChat中涉及到的系统参数</h2>



<h3 id="1-webchat中独有的系统参数">1. WebChat中独有的系统参数</h3>



<h4 id="chaton-ngs-chat插件中是否显示客户的来源类型"><code>CHATON</code> ngs chat插件中是否显示客户的来源类型</h4>

<p>引入系统参数<code>CHATON</code>(chat show type on name)，配置为1时候会显示客户来源类型(微信，手机，APP，还是PC，PC默认就不显示)。</p>



<h4 id="chaecs-ngs-chat插件是否与软电话互斥"><code>CHAECS</code> ngs chat插件是否与软电话互斥</h4>

<p>引入系统参数<code>CHAECS</code>(chat exclusion)，如果配置为1，表示chat和softphone不能同时为准备好状态。 <br>
这个配置包括了：</p>

<ol><li rel="1">当chat登录并且准备好时候，软电话点击登录按钮，会提示不能登录。</li>
<li rel="2">当chat登录并且准备好时候，如果软电话登录且为未准备好，这时候点击准备好按钮提示错误，不能准备好。</li>
<li rel="3">当softphone登录且状态为准备好时候，点击打开chat，提示不能打开chat。</li>
<li rel="4">当softphone登录且状态为准备好时候，如果这个时候chat为未准备好状态，点击切换到准备状态时候报错，不让起切换到准备好。</li>
</ol>

<h4 id="chasem-是否使用emoji表情"><code>CHASEM</code> 是否使用EMOJI表情</h4>

<p>引入系统参数<code>CHASEM</code>，配置为1时候，使用标准emoji作为表情包，默认时候用的qq表情包，当于rongcloud集成时候，客户端只提供了标准emoji的表情包，因此坐席端为了适配，也提供了相应的标准emoji表情。</p>



<h4 id="chtsty-ngs-chat插件界面样式"><code>CHTSTY</code> ngs chat插件界面样式</h4>

<p>引入系统参数<code>CHTSTY</code>(chat style)，表示使用的ngs中chat插件的样式，不配置就是默认，除了默认现在还支持一种样式:chat-white</p>

<h4 id="chassb-ngs-chat插件是否在聊天界面上直接显示转接相关按钮"><code>CHASSB</code>  ngs chat插件是否在聊天界面上直接显示转接相关按钮</h4>

<p>引入系统参数<code>CHASSB</code>(chat show session buttons)配置成1时候，聊天面板右上角会鲜明的显示出”会议”,”转接”,”转接组”三个按钮</p>



<h4 id="swaprl-ngs-chat插件左右布局位置"><code>SWAPRL</code> ngs chat插件左右布局位置</h4>

<p>引入系统参数<code>SWAPRL</code>，配置为1时候可以让左侧动态页面区域和右侧chat区域互换位置。</p>



<h4 id="chatad-ngs-chat插件访问webchat服务的地址"><code>CHATAD</code> ngs chat插件访问webchat服务的地址</h4>

<p>系统参数<code>CHATAD</code>，需要配置chat的服务地址，比如：<a href="http://192.168.2.80:8080/WebChat" target="_blank">http://192.168.2.80:8080/WebChat</a></p>



<h4 id="efsadd-ngs-chat插件中配置的ewcfront地址"><code>EFSADD</code> ngs chat插件中配置的EWCFront地址</h4>

<p>在还没有使用mongodb作为公共缓存方式时候，没有真正意义上的负载均衡，那时候是通过一个前置服务EWCFront，每次请求webchat之前，通过这个服务的一个接口，获取到一个正真可用的webchat地址，而这个系统参数，就是用来配置这个EWCFront服务的地址的（现在版本都已经不使用这个了）</p>

<h4 id="ctacsd-ngs-chat插件关闭会话时候是否发出事件"><code>CTACSD</code> ngs chat插件关闭会话时候是否发出事件</h4>

<p>引入系统参数<code>CTACSD</code>，配置成0时候，在chat界面关闭聊天时候，会发出事件，而不是直接关闭</p>



<pre class="prettyprint hljs-dark"><code class="language-javascript hljs"><span class="hljs-comment">//注册会话需要关闭事件</span><br>$project.events.register($CONST.ChatEvent.CHAT_SESSION_NEED_CLOSE, <span class="hljs-string">'dynPage'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">data</span>)</span>{<br>    <span class="hljs-keyword">var</span> sessionId = data.sessionId;<br>    <span class="hljs-comment">//自己的逻辑判断，这个会话是不是可以关闭，如果可以，</span><br>    <span class="hljs-comment">//就调用关闭的命令：project.events.notify(window.$CONST.ChatEvent.CLOSE_SESSION, {sessionId: 111});</span><br>    <span class="hljs-comment">//如果不可以，就给出提示，让用户先去做小结。 </span><br>});<br></code></pre>



<h4 id="chttag-ngs-chat插件中-客户标签表名"><code>CHTTAG</code> ngs chat插件中 客户标签表名</h4>

<p>ngs的chat插件添加客户标签的支持，引入系统参数<code>CHTTAG</code> 配置为对应tag表的表名，当配置了此参数，就会去读取相关tag信息。</p>



<pre class="prettyprint hljs-dark"><code class="language-sql hljs"><span class="hljs-operator"><span class="hljs-keyword">select</span> lt.labelid, lt.labelcomment, lt.labelbgcolor, lt.labelcolor <span class="hljs-keyword">from</span> <span class="hljs-string">" + tagTableName + "</span>${epid} <span class="hljs-keyword">l</span> <span class="hljs-keyword">left</span> <span class="hljs-keyword">join</span> customerlabeltype${epid} lt <span class="hljs-keyword">on</span> <span class="hljs-keyword">l</span>.relation_labelid = lt.labelid <span class="hljs-keyword">where</span> <span class="hljs-keyword">l</span>.relation_guid = ?</span><br></code></pre>

<p>根据这句sql查询出对应的标签用来显示</p>



<h4 id="cacren-ngs-chat插件中是否开启客户评级"><code>CACREN</code> ngs chat插件中是否开启客户评级</h4>



<pre class="prettyprint hljs-dark"><code class="language-sql hljs">dbpatch: <span class="hljs-operator"><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> customer <span class="hljs-keyword">add</span> webchat_rating <span class="hljs-built_in">float</span>;</span><br></code></pre>

<p>新增客户评级的属性，在ngs的chat插件中，可以给当前聊天客户评级。 <br>
配合系统参数<code>CACREN</code>，配置1时候，启用此功能。</p>



<h4 id="sronot-切换到机器人聊天时候的提示语"><code>SRONOT</code> 切换到机器人聊天时候的提示语</h4>

<p>标准客户chat页面中，增强了切换人工和机器人聊天时候的提示，并且引入系统参数<code>SRONOT</code>（start robot notice），当切换到机器人聊天时候，会自动发出这个系统参数中配置的信息。</p>



<h4 id="chatsm-结束会话时候是否要小结或者发出相关命令组通知客户端"><code>CHATSM</code> 结束会话时候是否要小结或者发出相关命令组通知客户端</h4>

<ul><li>引入系统参数<code>CHATSM</code>，如果配置为1，则话务员关闭session时候弹出小结界面，否则弹出是否关闭的确认框。</li>
<li>在坐席关闭会话时候，新增配置，支持通过询问右侧h5动态页面来获知是否允许关闭。 <br>
h5动态页面中P-240命令组新增参数ACTION，根据不同ACTION来做不同事情，之前的切换tab时候的ACTION的值是switchSession <br>
这里，当系统参数<code>CHATSM</code>配置成2时候，关闭会话会先去调用-240，ACTION为：</li>
</ul>



<pre class="prettyprint hljs-dark"><code class="language-javascript hljs">instance.doCmd(<span class="hljs-string">"P-240"</span>, {<br>    ACTION : <span class="hljs-string">"checkCloseEnabled"</span>, <br>    CUSTOMER_GUID : _currentCustomerGuid,<br>    SESSION_ID : _currentSessionId<br>})<br></code></pre>

<ul><li>ACTION固定为checkCloseEnabled，当前的CUSTOMER_GUID和SESSION_ID也会传递过去</li>
<li>同时接受返回参数，CLOSE_DISABLED和CLOSE_DISABLED_MSG 如果CLOSE_DISABLED为1，则不允许关闭，</li>
<li>弹出提示语，内容就是CLOSE_DISABLED_MSG中的值，如果CLOSE_DISABLED_MSG为空，默认提示语为：关闭前，请先对当前会话进行小结</li>
</ul>



<h4 id="srrtst-坐席是否显示满意度结果"><code>SRRTST</code> 坐席是否显示满意度结果</h4>

<p>引入系统参数<code>SRRTST</code>，配置成1时候，客户提交的满意度不会发送给客服知道。</p>



<h4 id="cmaxbu-客服允许的最大置忙数"><code>CMAXBU</code> 客服允许的最大置忙数</h4>

<p>引入系统参数<code>CMAXBU</code>(chat max busy)，配置一个数字，表示在线的客服允许的最大置忙数。 <br>
当坐席改变状态成非在线时候，会判断，如果当前置忙数已经大于等于这个限制了，则提示失败。</p>



<h4 id="ipbpar-黑名单规则"><code>IPBPAR</code> 黑名单规则</h4>

<p>1.UserIpInterceptor类中的intercept方法配合了chat_visit_ip_his表和chat_ip_blacklist表，实现了判断多长时间内，同一ip访问多少次后， <br>
自动加入黑名单的功能。</p>



<pre class="prettyprint hljs-dark"><code class="language-sql hljs">dbpatch:<br>    <span class="hljs-operator"><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> chat_ip_blacklist <span class="hljs-keyword">add</span> validity <span class="hljs-built_in">bigint</span>;</span><br>    <span class="hljs-operator"><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> chat_ip_visit_his(<br>        guid <span class="hljs-built_in">char</span>(<span class="hljs-number">36</span>),<br>        ip <span class="hljs-built_in">varchar</span>(<span class="hljs-number">30</span>),<br>        proxy_ip <span class="hljs-built_in">varchar</span>(<span class="hljs-number">30</span>),<br>        creation_time <span class="hljs-built_in">bigint</span><br>    )</span><br></code></pre>

<p>引入系统参数<code>IPBPAR</code>(ip blacklist params)，配置成一个json，类似: {checkIpTimeThreshold: 60, checkIpCountThreshold: 10, blacklistValidityElasped: 3600}</p>

<ul><li><strong>checkIpTimeThreshold</strong>表示检查多少时间内的，默认是1分钟，单位是秒</li>
<li><strong>checkIpCountThreshold</strong>表示多少次，也就是在某个时间范围内，同一个ip访问了多少次后，自动加入chat_ip_blacklist表，默认是10次</li>
<li><strong>blacklistValidityElasped</strong>表示加入chat_ip_blacklist的有效期持续多久，默认是1小时，单位是秒，-1表示永久</li>
</ul>



<h4 id="chslsc-显示历史会话内容数"><code>CHSLSC</code> 显示历史会话内容数</h4>

<p>引入系统参数<code>CHSLSC</code>(chat show last session count)，配置一个大于0的数字，在新请求进入时候，会查询进入的客户对应的历史会话内容，显示对应个数的会话。</p>



<h4 id="chahat-坐席端顶部显隐控制"><code>CHAHAT</code> 坐席端顶部显隐控制</h4>

<p>引入系统参数<code>CHAHAT</code>，配置成0，表示坐席端聊天页面顶部logo条隐藏。</p>



<h4 id="chatlt-坐席端显示布局类型"><code>CHATLT</code> 坐席端显示布局类型</h4>

<p>引入系统参数<code>CHATLT</code>（chat layout type）,不再需要手动去修改agentScript.js上的_layoutType参数了。</p>



<h3 id="2-那些公共使用的系统参数">2. 那些公共使用的系统参数</h3>



<h4 id="logdes-des加密时候的秘钥"><code>LOGDES</code> DES加密时候的秘钥</h4>

<p>登录验证时候，如果面使用的DES加密，则相关秘钥就存在<code>LOGDES</code>系统参数中。</p>



<h4 id="lognam-登录使用staff的agentid还是loginname"><code>LOGNAM</code> 登录使用staff的agent_id还是loginname</h4>

<p>和所有其他服务一样，通过此参数来决定staff登录时候用agent_id字段还是loginname字段来作为登录名。</p>



<h4 id="kmrurl-知识库服务地址"><code>KMRURL</code> 知识库服务地址</h4>

<p>这个在配置文件中有kmURL的配置项，用来配置知识库的地址。而<code>KMRURL</code>也是配置的知识库地址，优先级高于配置文件中的。</p></div></body>
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?99f0858c7fc5b9df4dde5e0d76b6af1c";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>
</html>